/*!
 * css-filters-polyfill.js
 *
 * Author: Christian Schepp Schaefer
 * Summary: A polyfill for CSS filter effects
 * License: MIT
 * Version: 0.22
 *
 * URL:
 * https://github.com/Schepp/
 *
 */
!function(e){var t={_ie:function(){for(var e,t=3,r=document.createElement("div"),s=r.getElementsByTagName("i");r.innerHTML="<!--[if gt IE "+ ++t+"]><i></i><![endif]-->",s[0];);return t>4?t:e}(),_svg_cache:{},_create_svg_element:function(e,t){var r="http://www.w3.org/2000/svg",s=document.createElementNS(r,e);for(key in t)s.setAttributeNS(null,key,t[key]);return s},_create_svg:function(e,t){var r="http://www.w3.org/2000/svg",s=document.createElementNS(r,"svg");s.setAttributeNS(null,"width","0"),s.setAttributeNS(null,"height","0"),s.setAttributeNS(null,"style","position:absolute");var i=document.createElementNS(r,"filter");i.setAttributeNS(null,"id",e),s.appendChild(i);for(var l=0;l<t.length;l++)i.appendChild(t[l]);return s},_pending_stylesheets:0,_stylesheets:[],_development_mode:function(){return"localhost"===location.hostname||-1!==location.hostname.search(/.local$/)||-1!==location.hostname.search(/\d+\.\d+\.\d+\.\d+/)?(e.console&&console.log("Detected localhost or IP address. Assuming you are a developer. Caching of stylesheets is disabled."),!0):(e.console&&console.log("Caching of stylesheets is enabled. You need to refresh twice to see any changes."),!1)}(),process_stylesheets:function(){var r=[];e.setTimeout(function(){if(e.XMLHttpRequest)var t=new XMLHttpRequest;else if(e.ActiveXObject)var t=new ActiveXObject("Microsoft.XMLHTTP");t.open("GET",e.polyfilter_scriptpath+"htc/sepia.htc",!0),t.onreadystatechange=function(){4==r.readyState&&200!=r.status&&alert('The configured path \r\rvar polyfilter_scriptpath = "'+e.polyfilter_scriptpath+'"\r\rseems wrong!\r\rConfigure the polyfill\'s correct absolute(!) script path before referencing the css-filters-polyfill.js, like so:\r\rvar polyfilter_scriptpath = "/js/css-filters-polyfill/";\r\rLeaving IE dead in the water is no option. You damn Mac user... ;)')};try{t.send(null)}catch(s){}},2e3);for(var s=document.querySelectorAll?document.querySelectorAll('style,link[rel="stylesheet"]'):document.getElementsByTagName("*"),i=0;i<s.length;i++)!function(r){switch(s[r].nodeName){default:break;case"STYLE":t._stylesheets.push({media:s[r].media||"all",content:s[r].innerHTML});break;case"LINK":if("stylesheet"===s[r].rel){var i=t._stylesheets.length;t._stylesheets.push({media:s[r].media||"all"}),t._pending_stylesheets++;var l=s[r].href;!t._development_mode&&e.localStorage&&e.localStorage.getItem("polyfilter_"+l)&&(t._pending_stylesheets--,t._stylesheets[i].content=localStorage.getItem("polyfilter_"+l),0===t._pending_stylesheets&&t.process());try{if(e.XMLHttpRequest)var n=new XMLHttpRequest;else if(e.ActiveXObject)var n=new ActiveXObject("Microsoft.XMLHTTP");n.open("GET",l,!0),n.onreadystatechange=function(){if(4===n.readyState)if(0===n.status)e.console&&console.log("Could not fetch external CSS via HTTP-Request "+l+". Probably because of cross origin."),t._stylesheets[i].content||(t._pending_stylesheets--,t._stylesheets[i].content=n.responseText,0===t._pending_stylesheets&&t.process());else if(t._stylesheets[i].content||(t._pending_stylesheets--,t._stylesheets[i].content=n.responseText,0===t._pending_stylesheets&&t.process()),!t._development_mode&&e.localStorage)try{e.localStorage.setItem("polyfilter_"+l,t._stylesheets[i].content)}catch(r){e.console&&console.log("Local storage quota have been exceeded. Caching of stylesheet "+l+" is not possible")}};try{n.send(null)}catch(a){e.console&&console.log("Could not fetch external CSS via HTTP-Request "+l+". Are you maybe testing using the file://-protocol?"),t._stylesheets[i].content||(t._pending_stylesheets--,0===t._pending_stylesheets&&t.process())}}catch(a){}}}}(i);0===this._pending_stylesheets&&this.process()},_processDeclarations:function(e){var r="";for(var s in e.declarations){var i=e.declarations[s];if("filter"===i.property){if(document.querySelectorAll)for(var l=document.querySelectorAll(e.mSelectorText),s=0;s<l.length;s++)l[s].style.polyfilterStore=i.valueText;var n=i.valueText,a=n.split(/\)\s+/),o={filtersW3C:[],filtersWebKit:[],filtersSVG:[],filtersIE:[],behaviorsIE:[]};for(idx in a){var c=a[idx]+")";currentproperties=t.convert(c);for(key in currentproperties)"undefined"!=typeof o[key]&&(o[key]=o[key].concat(currentproperties[key]))}if(r+=e.mSelectorText+"{",o.filtersW3C.length>0){{webkitFilter=mozFilter=oFilter=msFilter=o.filtersW3C.join(" ")}o.filtersWebKit&&o.filtersWebKit.length>0&&(webkitFilter=o.filtersWebKit.join(" ")),"undefined"==typeof this._ie&&(r+="-ms-filter:"+msFilter+";"),r+="-webkit-filter:"+webkitFilter+";",r+="-moz-filter:"+mozFilter+";",r+="-o-filter:"+oFilter+";"}if(o.filtersSVG.length>0)if("none"!=o.filtersSVG[0]){var f=n.replace(/[^a-z0-9]/g,"");if("undefined"==typeof this._svg_cache[f])if(this._svg_cache[f]=this._create_svg(f,o.filtersSVG),"undefined"==typeof XMLSerializer)document.body.appendChild(this._svg_cache[f]);else{var h=new XMLSerializer,p=h.serializeToString(this._svg_cache[f]);-1!=p.search("SourceGraphic")&&document.body.appendChild(this._svg_cache[f])}if("undefined"==typeof XMLSerializer)r+="filter: url(#"+f+")";else{var h=new XMLSerializer,p=h.serializeToString(this._svg_cache[f]);r+=-1!=p.search("SourceGraphic")?"filter: url(#"+f+")":"filter: url('data:image/svg+xml;utf8,"+p+"#"+f+"')"}}else r+="filter: none;";if("undefined"!=typeof this._ie){if(o.filtersIE.length>0){var d=o.filtersIE.join(" ");r+="filter:"+d+";"}if(o.behaviorsIE.length>0){var u=o.behaviorsIE.join(" ");r+="behavior:"+u+";"}}r+="}\r\n"}}return r},scriptpath:e.polyfilter_scriptpath?e.polyfilter_scriptpath:function(){return alert('Please configure the polyfill\'s absolute(!) script path before referencing the css-filters-polyfill.js, like so:\r\nvar polyfilter_scriptpath = "/js/css-filters-polyfill/";'),"./"}(),process:function(){for(var e=new CSSParser,r=0;r<this._stylesheets.length;r++){var s="",i=e.parse(this._stylesheets[r].content,!1,!0);if(null!==i)for(var l in i.cssRules){var n=i.cssRules[l];switch(n.type){default:break;case 1:s+=this._processDeclarations(n);break;case 4:s+="@media "+n.media.join(",")+"{";for(var a in n.cssRules){var o=n.cssRules[a];s+=this._processDeclarations(o)}s+="}"}}var c=document.createElement("style");c.setAttribute("media",this._stylesheets[r].media),"undefined"==typeof t._ie?(c.innerHTML=s,document.getElementsByTagName("head")[0].appendChild(c)):(document.getElementsByTagName("head")[0].appendChild(c),c.styleSheet.cssText=s)}},init:function(){Object.defineProperty&&Object.defineProperty(CSSStyleDeclaration.prototype,"polyfilter",{get:function(){return this.polyfilterStore},set:function(e){values=e.split(/\)\s+/);var r={filtersW3C:[],filtersWebKit:[],filtersSVG:[],filtersIE:[],behaviorsIE:[]};for(idx in values){var s=values[idx]+")";currentproperties=t.convert(s);for(key in currentproperties)"undefined"!=typeof r[key]&&(r[key]=r[key].concat(currentproperties[key]))}if(r.filtersW3C.length>0&&("undefined"==typeof t._ie&&(this.msFilter=r.filtersW3C.join(" ")),this.webkitFilter=this.mozFilter=this.oFilter=r.filtersW3C.join(" ")),r.filtersWebKit.length>0&&(this.webkitFilter=r.filtersWebKit.join(" ")),r.filtersSVG.length>0)if("none"!=r.filtersSVG[0]){var i=e.replace(/[^a-z0-9]/g,"");if("undefined"==typeof t._svg_cache[i])if(t._svg_cache[i]=t._create_svg(i,r.filtersSVG),"undefined"==typeof XMLSerializer)document.body.appendChild(t._svg_cache[i]);else{var l=new XMLSerializer,n=l.serializeToString(t._svg_cache[i]);-1!=n.search("SourceGraphic")&&document.body.appendChild(t._svg_cache[i])}if("undefined"==typeof XMLSerializer)this.filter="url(#"+i+")";else{var l=new XMLSerializer,n=l.serializeToString(t._svg_cache[i]);this.filter=-1!=n.search("SourceGraphic")?"url(#"+i+")":"url('data:image/svg+xml;utf8,"+n+"#"+i+"')"}}else this.filter="none";"undefined"!=typeof t._ie&&(this.filter=r.filtersIE.length>0?r.filtersIE.join(" "):"",this.behavior=r.behaviorsIE.length>0?r.behaviorsIE.join(" "):""),this.polyfilterStore=e}})},convert:function(e){var t=e.match(/none/i);if(null!==t)var r=this.filters.none();var t=e.match(/(grayscale)\(([0-9\.]+)\)/i);if(null!==t)var s=parseFloat(t[2],10),r=this.filters.grayscale(s);var t=e.match(/(sepia)\(([0-9\.]+)\)/i);if(null!==t)var s=parseFloat(t[2],10),r=this.filters.sepia(s);var t=e.match(/(blur)\(([0-9]+)[px]*\)/i);if(null!==t)var s=parseInt(t[2],10),r=this.filters.blur(s);var t=e.match(/(invert)\(([0-9\.]+)\)/i);if(null!==t)var s=parseFloat(t[2],10),r=this.filters.invert(s);var t=e.match(/(brightness)\(([0-9\.]+)%\)/i);if(null!==t)var s=parseFloat(t[2],10),r=this.filters.brightness(s);var t=e.match(/(drop\-shadow)\(([0-9]+)[px]*\s+([0-9]+)[px]*\s+([0-9]+)[px]*\s+([#0-9]+)\)/i);if(null!==t)var i=parseInt(t[2],10),l=parseInt(t[3],10),n=parseInt(t[4],10),a=t[5],r=this.filters.dropShadow(i,l,n,a);return r},filters:{none:function(){var e={};return"undefined"==typeof t._ie?(e.filtersW3C=["none"],e.filtersSVG=["none"]):e.filtersIE=["none"],e},grayscale:function(e){e=e||0;var r={};if("undefined"==typeof t._ie){r.filtersW3C=["grayscale("+e+")"];var s=t._create_svg_element("feColorMatrix",{type:"matrix",values:.2126+.7874*(1-e)+" "+(.7152-.7152*(1-e))+" "+(.0722-.0722*(1-e))+" 0 0 "+(.2126-.2126*(1-e))+" "+(.7152+.2848*(1-e))+" "+(.0722-.0722*(1-e))+" 0 0 "+(.2126-.2126*(1-e))+" "+(.7152-.7152*(1-e))+" "+(.0722+.9278*(1-e))+" 0 0 0 0 0 1 0"});r.filtersSVG=[s]}else r.filtersIE=e>=.5?["gray"]:[];return r},sepia:function(e){e=e||0;var r={};if("undefined"==typeof t._ie){r.filtersW3C=["sepia("+e+")"];var s=t._create_svg_element("feColorMatrix",{type:"matrix",values:.393+.607*(1-e)+" "+(.769-.769*(1-e))+" "+(.189-.189*(1-e))+" 0 0 "+(.349-.349*(1-e))+" "+(.686+.314*(1-e))+" "+(.168-.168*(1-e))+" 0 0 "+(.272-.272*(1-e))+" "+(.534-.534*(1-e))+" "+(.131+.869*(1-e))+" 0 0 0 0 0 1 0"});r.filtersSVG=[s]}else r.filtersIE=e>=.5?["gray","progid:DXImageTransform.Microsoft.Light()"]:[],r.behaviorsIE=e>=.5?['url("'+t.scriptpath+'htc/sepia.htc")']:[];return r},blur:function(e){e=Math.round(e)||0;var r={};if("undefined"==typeof t._ie){r.filtersW3C=["blur("+e+"px)"];var s=t._create_svg_element("feGaussianBlur",{"in":"SourceGraphic",stdDeviation:e});r.filtersSVG=[s]}else r.filtersIE=["progid:DXImageTransform.Microsoft.Blur(pixelradius="+e+")"];return r},invert:function(e){e=e||0;var r={};if("undefined"==typeof t._ie){r.filtersW3C=["invert("+e+")"];var s=t._create_svg_element("feComponentTransfer",{}),i=t._create_svg_element("feFuncR",{type:"table",tableValues:e+" "+(1-e)});s.appendChild(i);var i=t._create_svg_element("feFuncG",{type:"table",tableValues:e+" "+(1-e)});s.appendChild(i);var i=t._create_svg_element("feFuncB",{type:"table",tableValues:e+" "+(1-e)});s.appendChild(i),r.filtersSVG=[s]}else r.filtersIE=e>=.5?["invert"]:[];return r},brightness:function(e){e=e||0;var r={};if("undefined"==typeof t._ie){r.filtersW3C=["brightness("+e+"%)"],r.filtersWebKit=["brightness("+(e-100)+"%)"];var s=t._create_svg_element("feComponentTransfer",{}),i=t._create_svg_element("feFuncR",{type:"linear",slope:e/100});s.appendChild(i);var i=t._create_svg_element("feFuncG",{type:"linear",slope:e/100});s.appendChild(i);var i=t._create_svg_element("feFuncB",{type:"linear",slope:e/100});s.appendChild(i),r.filtersSVG=[s]}else r.filtersIE=["progid:DXImageTransform.Microsoft.Light()"],r.behaviorsIE=['url("'+t.scriptpath+'htc/brightness.htc")'];return r},dropShadow:function(e,r,s,i){e=Math.round(e)||0,r=Math.round(r)||0,s=Math.round(s)||0,i=i||"#000000";var l={};if("undefined"==typeof t._ie){l.filtersW3C=["drop-shadow("+e+"px "+r+"px "+s+"px "+i+")"];var n=t._create_svg_element("feGaussianBlur",{"in":"SourceAlpha",stdDeviation:s}),a=t._create_svg_element("feOffset",{dx:e+1,dy:r+1,result:"offsetblur"}),o=t._create_svg_element("feFlood",{"flood-color":i}),c=t._create_svg_element("feComposite",{in2:"offsetblur",operator:"in"}),f=t._create_svg_element("feMerge",{}),h=t._create_svg_element("feMergeNode",{});f.appendChild(h);var h=t._create_svg_element("feMergeNode",{"in":"SourceGraphic"});f.appendChild(h),l.filtersSVG=[n,a,o,c,f]}else l.filtersIE=["progid:DXImageTransform.Microsoft.Glow(color="+i+",strength=0)","progid:DXImageTransform.Microsoft.Shadow(color="+i+",strength=0)"],l.behaviorsIE=['url("'+t.scriptpath+'htc/drop-shadow.htc")'];return l}}};e.jQuery?e.jQuery(document).ready(function(){t.process_stylesheets()}):e.contentLoaded?contentLoaded(e,function(){t.process_stylesheets()}):e.addEventListener?document.addEventListener("DOMContentLoaded",function(){t.process_stylesheets()},!1):e.attachEvent&&e.attachEvent("onload",function(){t.process_stylesheets()}),t.init()}(window);